<UserControl x:Class="EMC.KeyValueBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:EMC"
             x:Name="Root">

    <UserControl.Resources>
        <!-- ✅ bool → CheckBox -->
        <DataTemplate x:Key="BoolTemplate">
            <Border Background="Transparent" Padding="8,0,0,0">
                <CheckBox IsChecked="{Binding Value, ElementName=Root, Mode=TwoWay}"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Left"
                          Cursor="Hand"
                          FontSize="{Binding ValueFontSize, ElementName=Root}"
                          FontWeight="{Binding ValueFontWeight, ElementName=Root}"/>
            </Border>
        </DataTemplate>

        <!-- ✅ 나머지 타입 → TextBox -->
        <DataTemplate x:Key="TextTemplate">
            <Border Background="Transparent" Padding="4,0,4,0">
                <TextBox Text="{Binding Value, ElementName=Root, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         VerticalContentAlignment="Center"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         Foreground="{Binding ValueForeground, ElementName=Root}"
                         FontSize="{Binding ValueFontSize, ElementName=Root}"
                         FontWeight="{Binding ValueFontWeight, ElementName=Root}"
                         BorderThickness="0"
                         Padding="6,0,6,0"
                         Background="Transparent"
                         PreviewTextInput="OnTextInput"/>
            </Border>
        </DataTemplate>

        <!-- ✅ Template Selector -->
        <local:ValueTemplateSelector
            x:Key="ValueTemplateSelector"
            BoolTemplate="{StaticResource BoolTemplate}"
            TextTemplate="{StaticResource TextTemplate}" />
    </UserControl.Resources>

    <!-- ✅ 크기를 유연하게 (Height 고정 제거) -->
    <Grid VerticalAlignment="Center" MinHeight="36">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*" />
            <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>

        <!-- Key 영역 -->
        <Border Grid.Column="0"
                Background="{Binding KeyBackground, ElementName=Root}"
                CornerRadius="4,0,0,4"
                Padding="8,4"
                Margin="4,0,0,0">
            <TextBlock Text="{Binding Key, ElementName=Root}"
                       VerticalAlignment="Center"
                       Foreground="{Binding KeyForeground, ElementName=Root}"
                       FontSize="{Binding KeyFontSize, ElementName=Root}"
                       FontWeight="{Binding KeyFontWeight, ElementName=Root}"
                       TextAlignment="Center"/>
        </Border>

        <!-- Value 영역 -->
        <Border Grid.Column="1"
                BorderBrush="LightGray"
                BorderThickness="1"
                CornerRadius="0,4,4,0"
                Margin="0,0,4,0"
                Background="White">
            <ContentControl Content="{Binding Value, ElementName=Root}"
                            ContentTemplateSelector="{StaticResource ValueTemplateSelector}"
                            VerticalAlignment="Stretch"
                            HorizontalAlignment="Stretch"/>
        </Border>
    </Grid>
</UserControl>
